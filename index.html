<html lang="ru">
<head>
<meta charset="utf-8">
<title>–°–º–µ—Ç–∞ –ì–ü ‚Äî –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{background:#0b1020;color:#e9eeff;font-family:system-ui;margin:0}
.wrap{max-width:1400px;margin:30px auto;padding:0 20px}
.card{background:#121a33;border-radius:12px;padding:18px;margin-bottom:18px}
h1{font-size:20px}
h2{font-size:14px;color:#9fbfff}
table{width:100%;border-collapse:collapse}
td,th{padding:8px;border-bottom:1px solid #334155;text-align:right}
th{text-align:left}
input,select{width:100%;padding:6px;background:#0b1229;border:1px solid #334155;color:white;border-radius:6px}
button{padding:8px 12px;background:#1e40af;border:none;color:white;border-radius:6px;margin-top:10px;cursor:pointer}
.ok{color:#22c55e}
.bad{color:#ef4444}
.small{font-size:11px;color:#9aa7c7}
</style>
</head>

<body>
<div class="wrap">

<h1>–°–º–µ—Ç–∞ –ì–µ–Ω–ø–æ–¥—Ä—è–¥—á–∏–∫–∞ ‚Äî –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –∏ –£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç—É—Ä</h1>

<div class="card">
<h2>1Ô∏è‚É£ –ë—é–¥–∂–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞ (—Å—Ç–æ–ª–±–µ—Ü C)</h2>
<table>
<tr><th>–ì–ª–∞–≤–∞ 2</th><td id="budgetOut"></td></tr>
<tr><th>2.6‚Äì2.9</th><td id="excludedOut"></td></tr>
<tr><th><b>–ë–∞–∑–∞ 2.1‚Äì2.5</b></th><td id="baseOut"></td></tr>
</table>
</div>

<div class="card">
<h2>2Ô∏è‚É£ –ü—Ä—è–º—ã–µ –¥–æ–≥–æ–≤–æ—Ä—ã –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤</h2>
<table id="suppliers">
<thead>
<tr>
<th>–°—Ç–∞—Ç—å—è</th>
<th>–°—É–º–º–∞</th>
<th></th>
</tr>
</thead>
<tbody></tbody>
</table>
<button onclick="addRow()">–î–æ–±–∞–≤–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä</button>
</div>

<div class="card">
<h2>4Ô∏è‚É£ –õ–∏–º–∏—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ –ì–ü</h2>
<table>
<tr><th>–°—É–º–º–∞ –ø—Ä—è–º—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤</th><td id="supplierOut"></td></tr>
<tr><th><b>–õ–∏–º–∏—Ç –ì–ü</b></th><td id="limitOut"></td></tr>
</table>
</div>

<div class="card">
<h2>5Ô∏è‚É£ –ë–∞–Ω–∫–æ–≤—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–º–µ—Ç—ã –ì–ü (2.1‚Äì2.5)</h2>
<table>
<tr><th>2.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥</th><td id="s21"></td></tr>
<tr><th>2.2.1 –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—Ç–¥–µ–ª–∫–∞</th><td id="s221"></td></tr>
<tr><th>2.2.2 –û–±—â–µ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–µ</th><td id="s222"></td></tr>
<tr><th>2.3 –ò–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã</th><td id="s23"></td></tr>
<tr><th>2.4 –ù–∞—Ä—É–∂–Ω—ã–µ —Å–µ—Ç–∏</th><td id="s24"></td></tr>
<tr><th>2.5 –ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</th><td id="s25"></td></tr>
<tr><th><b>–ò–¢–û–ì–û</b></th><td id="structureTotal"></td></tr>
</table>
<div class="small">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –±–∞–∑–µ –±–µ–∑ –ø—Ä—è–º—ã—Ö –¥–æ–≥–æ–≤–æ—Ä–æ–≤.</div>
</div>

<div class="card">
<h2>üü£ –£–ø—Ä–∞–≤–ª–µ–Ω—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑</h2>
<label>–ù–∞–∫–ª–∞–¥–Ω—ã–µ (%)</label><input id="oh" value="10" oninput="calculate()">
<label>–ü—Ä–∏–±—ã–ª—å (%)</label><input id="pr" value="6" oninput="calculate()">

<table>
<tr><th>Direct</th><td id="uDirect"></td></tr>
<tr><th>–ù–∞–∫–ª–∞–¥–Ω—ã–µ</th><td id="uOh"></td></tr>
<tr><th>–ü—Ä–∏–±—ã–ª—å</th><td id="uPr"></td></tr>
<tr><th><b>–ò–¢–û–ì–û</b></th><td id="uTotal"></td></tr>
</table>
</div>

<button onclick="calculate()">–ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å</button>

</div>

<script>

// –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±–∞–Ω–∫–∞
const budget = 613842008;
const g26 = 4000000;
const g27 = 44830000;
const g28 = 26806612;
const g29 = 50903148;

// –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ 2.1‚Äì2.5 –∏–∑ —Å—Ç–æ–ª–±—Ü–∞ C
const baseStructure = {
"2.1": 49828259,
"2.2.1": 31866900,
"2.2.2": 293672177,
"2.3": 61448739,
"2.4": 29310429,
"2.5": 21175742
};

function f(x){
  return Math.round(x).toLocaleString("ru-RU")+" ‚ÇΩ";
}

function addRow(){
  let tr = document.createElement("tr");
  tr.innerHTML=`
  <td>
    <select onchange="calculate()">
      <option value="2.1">2.1</option>
      <option value="2.2.1">2.2.1</option>
      <option value="2.2.2">2.2.2</option>
      <option value="2.3">2.3</option>
      <option value="2.4">2.4</option>
      <option value="2.5">2.5</option>
    </select>
  </td>
  <td><input oninput="calculate()"></td>
  <td><button onclick="this.parentElement.parentElement.remove();calculate()">X</button></td>
  `;
  document.querySelector("#suppliers tbody").appendChild(tr);
}

// —Ä–∞—Å—á—ë—Ç
function calculate(){

  const excludedSum = g26 + g27 + g28 + g29;
  const base = budget - excludedSum;

  budgetOut.innerHTML = f(budget);
  excludedOut.innerHTML = f(excludedSum);
  baseOut.innerHTML = f(base);

  let supplierSum = 0;
  document.querySelectorAll("#suppliers tbody tr").forEach(r=>{
    let sum = parseFloat(r.children[1].children[0].value) || 0;
    supplierSum += sum;
  });

  const limit = base - supplierSum;

  supplierOut.innerHTML = f(supplierSum);
  limitOut.innerHTML = f(limit);

  // –ø–µ—Ä–µ—Å—á—ë—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ª–∏–º–∏—Ç—É
  let totalBefore = 0;
  for(let key in baseStructure) totalBefore += baseStructure[key];

  let totalAfter = 0;
  for(let key in baseStructure){
    let val = Math.round(baseStructure[key] * (limit/totalBefore));
    document.getElementById("s"+key.replace(".","")).innerHTML = f(val);
    totalAfter += val;
  }

  structureTotal.innerHTML = f(totalAfter);
  structureTotal.className = (Math.round(totalAfter) === Math.round(limit)) ? "ok" : "bad";

  // —É–ø—Ä–∞–≤–ª–µ–Ω–∫–∞
  let ohPct = parseFloat(oh.value)/100;
  let prPct = parseFloat(pr.value)/100;

  let directCost = limit / (1 + ohPct + prPct*(1+ohPct));
  let ohCost = directCost * ohPct;
  let prCost = (directCost + ohCost) * prPct;

  uDirect.innerHTML = f(directCost);
  uOh.innerHTML = f(ohCost);
  uPr.innerHTML = f(prCost);
  uTotal.innerHTML = f(directCost + ohCost + prCost);

}

// —Å—Ç–∞—Ä—Ç
addRow();
calculate();

</script>
</body>
</html>
